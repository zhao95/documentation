<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Vapor Documentation</title>

        <link rel="stylesheet"  href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
        <link rel="stylesheet"  href="https://fonts.googleapis.com/css?family=Quicksand:400,700,300">
        <link rel="stylesheet" href="https://vapor.github.io/documentation/styles/vapor-code.css">
        <link rel="stylesheet" href="https://vapor.github.io/documentation/styles/main.css">
    </head>
    <body>

        <header>
            <a class="logo" href="https://vapor.github.io/documentation/">
                <img src="https://vapor.github.io/documentation/images/droplet.svg" alt="Vapor">
                <h1>Vapor <em>Docs</em></h1>
            </a>
            <ul>
                <li>
                    <a href="http://vapor.codes">Home</a>
                </li>
                <li>
                    <a href="http://example.vapor.codes">Example</a>
                </li>
                <li>
                    <a href="https://github.com/vapor/vapor">GitHub</a>
                </li>
                <li>
                    <a href="https://twitter.com/@codevapor">Twitter</a>
                </li>
                <li>
                    <a href="http://vapor.team">Slack</a>
                </li>
            </ul>
        </header>

        <nav>
            <div class="scroll">
                            <section>
                    <h3>Getting Started</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-swift-3-macos.html">
                                Install Swift 3: macOS
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-swift-3-ubuntu.html">
                                Install Swift 3: Ubuntu
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-swift-3.html">
                                Install Swift 3
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/install-toolbox.html">
                                Install Toolbox
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/manual.html">
                                Manual
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/hello-world.html">
                                Hello, World
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/getting-started/xcode.html">
                                Xcode
                            </a>
                        </li>
                                        </ul>
                </section>
                            <section>
                    <h3>Guide</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/droplet.html">
                                Droplet
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/folder-structure.html">
                                Folder Structure
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/json.html">
                                JSON
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/config.html">
                                Config
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/views.html">
                                Views
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/middleware.html">
                                Middleware
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/validation.html">
                                Validation
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/provider.html">
                                Provider
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/guide/hash.html">
                                Hash
                            </a>
                        </li>
                                        </ul>
                </section>
                            <section>
                    <h3>Routing</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/basic.html">
                                Basic
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/parameters.html">
                                Parameters
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/group.html">
                                Group
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/routing/collection.html">
                                Collection
                            </a>
                        </li>
                                        </ul>
                </section>
                            <section>
                    <h3>Fluent</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/fluent/driver.html">
                                Driver
                            </a>
                        </li>
                                            <li class="active">
                            <a href="https://vapor.github.io/documentation/fluent/model.html">
                                Model
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/fluent/query.html">
                                Query
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/fluent/relation.html">
                                Relation
                            </a>
                        </li>
                                        </ul>
                </section>
                            <section>
                    <h3>HTTP</h3>
                    <ul>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/request.html">
                                Request
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/response.html">
                                Response
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/body.html">
                                Body
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/response-representable.html">
                                ResponseRepresentable
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/responder.html">
                                Responder
                            </a>
                        </li>
                                            <li class="">
                            <a href="https://vapor.github.io/documentation/http/client.html">
                                Client
                            </a>
                        </li>
                                        </ul>
                </section>
                        </div>
        </nav>

        <main>
            <a href="https://github.com/vapor/documentation/blob/master/CONTRIBUTING.md" class="edit">âœŽ Edit on GitHub</a>
            <h1 id="model">Model</h1>
<p><code>Model</code> is the base protocol for any of your application's models, especially those you want to persist. </p>
<blockquote>
<p><code>Model</code> is only available in Vapor, the Fluent equivalent is <code>Entity</code></p>
</blockquote>
<h2 id="example">Example</h2>
<p>Let's create a simple <code>User</code> model.</p>
<pre><code class="language-swift">final class User {
    var name: String

    init(name: String) {
        self.name = name
    }
}</code></pre>
<p>The first step to conforming to <code>Model</code> is to import Vapor and Fluent.</p>
<pre><code class="language-swift">import Vapor
import Fluent</code></pre>
<p>Then add the conformance to your class.</p>
<pre><code class="language-swift">final class User: Model { 
    ...
}</code></pre>
<p>The compiler will inform you that some methods need to be implemented to conform.</p>
<h3 id="id">ID</h3>
<p>The first required property is an identifier. This property will contain the identifier when the model is fetched from the database. If it is nil, it will be set when the model is saved.</p>
<pre><code class="language-swift">final class User: Model {
    var id: Node?
    ...
}</code></pre>
<h3 id="node-initializable">Node Initializable</h3>
<p>The next requirement is a way to create the model from the persisted data. Model uses <code>NodeInitializable</code> to achieve this.</p>
<pre><code class="language-swift">final class User: Model {
    init(node: Node, in context: Context) throws {
        id = try node.extract("id")
        name = try node.extract("name")
    }
    ...
}</code></pre>
<p>The keys <code>id</code> and <code>name</code> are what we expect the columns or fields in the database to be named. The <code>extract</code> call is marked with a <code>try</code> because it will throw an error if the value is not present or is the wrong type. </p>
<h3 id="node-representable">Node Representable</h3>
<p>Now that we have covered initializing the model, we need to show it how to save back into the database. Model uses <code>NodeRepresentable</code> to achieve this.</p>
<pre><code class="language-swift">final class User: Model {
    func makeNode() throws -&gt; Node {
        return try Node(node: [
            "id": id,
            "name": name
        ])
    }
    ...
}</code></pre>
<p>When a <code>User</code> is saved, the <code>makeNode()</code> method will be called and the resulting <code>Node</code> will be saved to the database. The keys <code>id</code> and <code>name</code> are what we expect the columns or fields in the database to be named.</p>
<h2 id="preparations">Preparations</h2>
<p>Some databases, like MySQL, need to be prepared for a new schema. In MySQL, this means creating a new table. </p>
<h3 id="prepare">Prepare</h3>
<p>Let's assume we are using a SQL database. To prepare the database for our <code>User</code> class, we need to create a table. If you are using a database like Mongo, you can leave this method unimplemented.</p>
<pre><code class="language-swift">final class User {
    static func prepare(_ database: Database) throws {
        try database.create("users") { users in
            users.id()
            users.string("name")
        }
    }
    ...
}</code></pre>
<p>Here we create a table named <code>users</code> that has an identifier field and a string field with the key <code>name</code>. This matches both our <code>init(node: Node)</code> and <code>makeNode() -&gt; Node</code> methods.</p>
<h3 id="revert">Revert</h3>
<p>An optional preparation reversion can be created. This will be run if <code>vapor run prepare --revert</code> is called. </p>
<pre><code class="language-swift">final class User {
    static func revert(_ database: Database) throws {
        try database.delete("users")
    }
    ...
}</code></pre>
<p>Here we are deleting the table named <code>users</code>.</p>
<h3 id="droplet">Droplet</h3>
<p>To run these prepations when the applications boots, you must add the Model to the <code>Droplet</code>.</p>
<pre><code class="language-swift">let drop = Droplet(preparations: [User.self])</code></pre>
<h2 id="full-model">Full Model</h2>
<p>This is what our final <code>User</code> model looks like:</p>
<pre><code class="language-swift">import Vapor
import Fluent

final class User: Model {
    var id: Node?
    var name: String

    init(name: String) {
        self.name = name
    }

    init(node: Node, in context: Context) throws {
        id = try node.extract("id")
        name = try node.extract("name")
    }

    func makeNode() throws -&gt; Node {
        return try Node(node: [
            "id": id,
            "name": name
        ])
    }

    static func prepare(_ database: Database) throws {
        try database.create("users") { users in
            users.id()
            users.string("name")
        }
    }

    static func revert(_ database: Database) throws {
        try database.delete("users")
    }
}</code></pre>
<h2 id="interacting">Interacting</h2>
<p>Now that <code>User</code> conforms to <code>Model</code>, it has a plethora of new methods like <code>find()</code>, <code>query()</code>, <code>makeJSON()</code> and more.</p>
<h3 id="fetch">Fetch</h3>
<p>Models can be fetched by their database identifier.</p>
<pre><code class="language-swift">let user = try User.find(42)</code></pre>
<h3 id="save">Save</h3>
<p>Newly created models can be saved to the database.</p>
<pre><code class="language-swift">var user = User(name: "Vapor")
try user.save()
print(user.id) // prints the new id</code></pre>
<h3 id="delete">Delete</h3>
<p>Persisted models with identifiers can be deleted.</p>
<pre><code class="language-swift">try user.delete()</code></pre>
<h2 id="model-vs-entity">Model vs. Entity</h2>
<p>Model has a couple of extra conformances that a pure Fluent entity doesn't have.</p>
<pre><code class="language-swift">public protocol Model: Entity, JSONRepresentable, StringInitializable, ResponseRepresentable {}</code></pre>
<p>As can be seen in the protocol, Vapor models can automatically convert to <code>JSON</code>, <code>Response</code>, and even be used in type-safe routing.</p>
        </main>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="https://vapor.github.io/documentation/scripts/highlight.pack.js"></script>

        <script>
            $(function() {
                // Syntax highlighting
                hljs.initHighlightingOnLoad();

                if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {
                    $('body').addClass('safari');
                }

                $('h1, h2, h3, h4, h5, h6').each(function(key, item) {
                    var $item = $(item);
                    var id = $item.attr('id');
                    if (id) {
                        var link = $('<a>');
                        link.attr('href', '#' + id);
                        console.log(link)
                        $item.wrap(link);
                    }
                })
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-76177358-4', 'auto');
            ga('send', 'pageview');
        </script>

    </body>
</html>
